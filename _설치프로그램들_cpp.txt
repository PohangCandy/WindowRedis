. redis

redis 는 윈도우용이 별도로 제공되지 않음.
마이크로소프트에서 다양한 오픈소스를 윈도우용으로 컨버팅하여 제공하고 있으며, 이를 사용
다만 redis 버전이 최신은 아님.

https://github.com/MicrosoftArchive/redis/releases


---------------------------------------------------------------------------------

redis_cli.exe   로 


레디스에 연결하여 사용가능.

set / get  으로 key 넣고 확인 가능.





/////////////// cpp 에서 redis 연동하기 /////////////////////////

. cpp-redis 빌드
cpp 코드에서 redis 를 사용하기 위해서 redis c++ client 라이브러리를 받아야 함
가장 많이 사용하는 cpp-redis 를 사용해봄

다만...... 빌드된 lib,dll 이 없으므로 직접 다운로드 받아서 빌드를 해야함

1. cpp_redis 소스코드 다운로드

https://github.com/cpp-redis/cpp_redis
Code > Download Zip 으로 최신 cpp redis  버전을 다운로드 받음

2. tacopie 소스코드 다운로드
https://github.com/cpp-redis/tacopie
cpp-redis 가 tacopie tcp 라이브러리를 기반으로 만들어져서 tacopie 소스를 또 받아야함.

3. tacopie 코드를 cpp-redis 폴더로 이동
cpp-redis 의 tacopie 폴더에 가보면  아무것도 없음이 확인됨.
cpp_redis-master\tacopie

여기에 tacopie-master.zip 의 압축을 풀어서 그대로 집어넣음.

4. cpp-redis 빌드
cpp_redis-master\msvc15  폴더에서  cpp_redis.sln 을 비주얼스튜디오로 오픈 후 빌드

cpp_redis 와 tacopie 2개의 프로젝트가 모두 잘 빌드 되기를 기도 합니다

* 확인필요사항

cpp_redis 프로젝트 속성 > 일반 > Windows SDK / 플렛폼 도구집합
tacopie 프로젝트 속성 > 일반 > Windows SDK / 플렛폼 도구집합

위 2 항목에 대해 내 Visual Studio 에 설치된 항목으로 선택




5. include 헤더폴더 복사

사용 프로젝트의 폴더에 cpp_redis-master\includes  안의 cpp_redis 를 복사하여 넣습니다.
사용 프로젝트의 폴더에 cpp_redis-master\tacopie\includes 안의 tacopie 를 복사하여 넣습니다.

cpp_redis 와 tacopie 의 모든 헤더파일 내의 include 는 <> 로 되어있으므로,  cpp_redis 폴더의 상위경로를 포함디렉터리에 넣어야함

프로젝트 속성 > VC++디렉터리 > 포함 디렉터리에       $(ProjectDir);      추가
이는 자신 프로젝트 폴더를 <> 포함 폴더로 지정함.

#include <cpp_redis/xxxx>
#include <tacopie/xxxx>  

를 되도록 함.




6. lib , pdb 복사

cpp_redis-master\msvc15\x64\Debug   폴더의   (빌드 상황에 따라 적절한 폴더 나오겠음)

cpp_redis.lib
cpp_redis.pdb
tacopie.lib
tacopie.pdb

를 내 프로젝트 폴더로 복사함


-------------- 아래는 가장 기본적인 cpp_redis 샘플코드 -------------------------

#include <iostream>
#include <cpp_redis/cpp_redis>
#pragma comment (lib, "cpp_redis.lib")
#pragma comment (lib, "tacopie.lib")
#pragma comment (lib, "ws2_32.lib")

int main()
{
	WORD version = MAKEWORD(2, 2);
	WSADATA data;
	WSAStartup(version, &data);


	cpp_redis::client client;

	client.connect();

	client.set("hello", "42");
	client.get("hello", [](cpp_redis::reply& reply) {
		std::cout << reply << std::endl;
		});
	//! also support std::future
	//! std::future<cpp_redis::reply> get_reply = client.get("hello");

	client.sync_commit();
	//! or client.commit(); for asynchronous call}
}


redis 서버 가동 후 해당 프로젝트 작동시 잘 되면  끝.  잘 안되면   위로


# 확인사항

cpp_redis.lib / tacopie.lib / 내 프로젝트   이렇게 3개 빌드 셋팅은 통일 되어야함

x86 / x64
debug / release
+ 런타임라이브러리 DLL 여부 

이 사항이 하나라도 맞지 않으면 프로젝트 빌드시 에러 발생.



//////////////////////////////////////////////////////////

 람다 예제

//////////////////////////////////////////////////////////

void main()
{
	std::function<bool(int, char)> functor;

	int main_x = 1;

	
	// std::function  람다를 받는 객체 ( C 의 함수포인터 역할 )
	// std::function<리턴타입(인자)> functor;

	// 람다 = [변수캡쳐](인자들) -> 리턴타입 { .... }
	//
	// 변수 캡쳐 
	// [] : 아무것도 캡처하지 않음
	// [=] : 모든 외부 변수를 Capture by value
	// [&] : 모든 외부 변수를 Capture by reference
	// [x] : x만 Capture by value / 수정불가
	// [&x]: x만 Capture by reference / 수정가능
	// [x,y] : x,y 를 Capture by value
	// [&x,y] : x는 Capture by reference , y는 Capture by value
	// [&, y] : y 를 제외한 모든 값을 Capture by reference
	// [=, &x] : x 를 제외한 모든 값을 Capture by value

    functor = [=](int i, int x) ->bool {
		i++;
		x++;
		int z = main_x;// ++;   

		std::wcout << "i:" << i << " / x:" << x << " / main_x:" << main_x << std::endl;
		return true;
    };
 
	functor(1, 10);
	functor(2, 20);

	return 0;
}
